# Pavel Bot Video Sport

Телеграм-бот на Python 3.11+ и aiogram 3.x с оплатой YooMoney и доступом к видео по подписке.

## Быстрый старт

1. Создайте виртуальное окружение и установите зависимости:
   ```bash
   python3.11 -m venv .venv
   source .venv/bin/activate
   pip install -r requirements.txt
   ```
2. Скопируйте `.env.example` в `.env` и заполните значения:
   ```bash
   cp .env.example .env
   ```
3. Запустите бота:
   ```bash
   python main.py
   ```

База данных создается автоматически при первом запуске.

## Настройка видео

Есть два способа заполнить `file_id` видео:

- Через `.env`: укажите `VIDEO_1_FILE_ID` ... `VIDEO_10_FILE_ID` и перезапустите бота.
- Через админ-команду `/cp`:
  1. Отправьте `/cp` от имени администратора.
  2. Отправьте видео с подписью `1`..`10` (номер урока).
  3. Бот ответит `file_id` и строкой для вставки в `.env`.

## Проверка оплаты

- После оплаты нажмите кнопку «Проверить оплату».
- Бот также проверяет платежи автоматически каждые `CHECK_PAYMENTS_INTERVAL_SEC` секунд.

## Основные сценарии

- `/start` — приветственное видео + главное меню.
- «Корпоративный клиент» — ввод пароля и доступ ко всем 10 видео.
- «Обычный клиент» — выбор уроков, расчет цены, оплата по ссылке, доступ на 30 дней.
- «Мои видео» — доступные уроки для текущего пользователя.
- «Поддержка» — контакт из `SUPPORT_CONTACT`.
- «Админ-панель» — доступна только администраторам из `ADMIN_IDS`.

## Примеры

- Выбрать три видео: нажмите по «Видео 1», «Видео 2», «Видео 3», затем «Оплатить».
- Проверить оплату: кнопка «Проверить оплату» на экране платежа.
- Получить `file_id`: `/cp` → отправить видео с подписью `4`.

## Админ-панель

- Статистика и экспорт в Excel (`.xlsx`).
- Рассылки: текст, фото, видео, кружочки (с HTML-форматированием).
- Смена корпоративного пароля, перевод клиента в обычного.
- Управление видео: добавить/удалить.
- Изменение текста перед выбором уроков.

## Примечания

- Доступ к купленным видео открывается на 30 дней. Повторная покупка продлевает срок.
- Отправленные видео автоматически удаляются через 24 часа либо при окончании доступа.
- Все необработанные ошибки отправляются админу из `ERROR_ADMIN_ID`.
